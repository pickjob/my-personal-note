# UrlEncoder UrlDecoder主要是用户URI百分号编码,解码
- URLEncoder
    - dontNeedEncoding:BitSet用于保存不需要编码的字符
    ```java
    dontNeedEncoding = new BitSet(256);
    int i;
    for (i = 'a'; i <= 'z'; i++) {
        dontNeedEncoding.set(i);
    }
    ...
    dontNeedEncoding.set('*');
    ```
    - 编码
    ```java
    //如果不需编码会返回原字符串
    boolean needToChange = false; 
    ...
    charArrayWriter.write(c);
    //Java 使用UTF-16表示一个Unicode,判断是否可能4个字符表示Unicode
    if (c >= 0xD800 && c <= 0xDBFF) { 
        if ( (i+1) < s.length()) {
            int d = (int) s.charAt(i+1);
            if (d >= 0xDC00 && d <= 0xDFFF {
                charArrayWriter.write(d);
                i++;
            }
        }
    }
    ...
    //将字节转为字符，并且小写字母转为大写
    out.append('%');
    char ch = Character.forDigit((ba[j] >>4) & 0xF, 16);
    if (Character.isLetter(ch)) { 
        ch -= caseDiff;
    }
    out.append(ch);
    ch = Character.forDigit(ba[j] & 0xF,16);
    if (Character.isLetter(ch)) {
        ch -= caseDiff;
    }
    out.append(ch);
    ```
- URLDecoder
    - 解码
    ```java
    //如果不需解码会返回原字符串
    boolean needToChange = false;
    ...
    c = s.charAt(i);
    switch (c) {
    case '+':
        sb.append(' ');
        i++;
        needToChange = true;
        break;
    case '%':
        try 
            // (numChars-i)/3 is an upper bound for the number of remaining bytes
            if (bytes == null)
                bytes = new byte[(numChars-i)/3];
            int pos = 0
            while ( ((i+2) < numChars) &&
                    (c=='%')) {
                int v = Integer.parseInt(s.substring(i+1,i+3),16);
                if (v < 0)
                    throw new IllegalArgumentException("URLDecoder: Illegal hex characters in escape (%) pattern negative value");
                bytes[pos++] = (byte) v;
                i+= 3;
                if (i < numChars)
                    c = s.charAt(i);
            // A trailing, incomplete byte encoding such as "%x" will cause an exception to be throw
            if ((i < numChars) && (c=='%'))
                throw new IllegalArgumentException(
                 "URLDecoder: Incomplete trailing escape (%) pattern")
            sb.append(new String(bytes, 0, pos, enc));
        } catch (NumberFormatException e) {
            throw new IllegalArgumentException(
            "URLDecoder: Illegal hex characters in escape (%) pattern - "
            + e.getMessage());
        }
        needToChange = true;
        break;
    default:
        sb.append(c);
        i++;
        break;
    ```