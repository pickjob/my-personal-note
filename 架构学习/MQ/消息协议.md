# 消息队列学习
- 场景
    - 异步通信
    - 解耦
    - 冗余
    - 扩展性
    - 过载保护
    - 可恢复性
    - 顺序保护
    - 缓冲
    - 数据流处理
- 消息投递保证
    - At most once：消息可能会丢，但绝不会重复投递
    - At least one：消息绝不会丢，但可能会重复投递
    - Exactly once：每条消息肯定会被投递一次且仅投递一次，很多时候这是用户所想要的
- Advanced Message Queuing Protocol (AMQP)
    - 基本概念
        - Message (消息)
        - Publisher (消息生产者)
        - Exchanger (交换器)
            - Direct
            - Fanout
            - Topic
            - Headers
        - Binding (绑定)
        - Virtual Host (虚拟主机)
        - Broker (消息代理)
        - Routing Key (路由规则)
        - Queue (消息队列)
        - Connection (连接)
        - Channel (信道)
        - Consumer (消息消费者)
    - 消息生命周期
        - Publisher生产一条数据
        - 发给Broker
        - Broker中Exchanger(规则表 Routing Key 和 Queue 映射关系--Binding)根据Routing Key查询投递的目标Queue
        - Consumer向Broker发送订阅消息指定自己监听那个Queue
        - 数据到达Queue时Broker会推送数据到Comsumer
- Message Queueing Telemetry Transport (MQTT)
    - 基本概念
        - Publisher (发布者)
        - Broker (代理)
        - Subscriber (订阅者)
        - Network Connection (网络连接)
        - Application MEssage (应用消息)
        - Topic (主题)
        - Playload (负载)
        - Client (客户端)
        - Server (服务器)
        - Session (绘画)
        - Subscription (订阅)
        - Topic Name (主题名)
        - Topic Filter (主题过滤器)
        - MQTT控制报文(MQTT COntrol Packet)
    - 通信场景
        - 建立连接
        - 发布消息
            - QoS 0 (至多一次)
            - QoS 1 (至少一次)
            - QoS 2 (只有一次)
        - 主题订阅
        - 心跳检测
- Streaming Text Orientated Messaging Proocol (STOMP)
    - Comand
        - CONNECT
        - CONNECTED
        - STOMP
        - SEND
        - SUBSCRIBE
        - UNSUBSCRIBE
        - BEGIN
        - COMMIT
        - ABORT
        - ACK
        - NACK
        - DISCONNECT
        - MESSAGE
        - RECEIPT
        - ERROR
- XMPP
- JMS
    - 模式
        - 点对点
        - 发布订阅
    - 基本概念
        - JMS Client
        - Message
        - JMS Provider
        - Administered Object
        - Producer
        - Comsumer
        - Client
        - Queue
        - Topic
        - Message
    - API
        - ConnectionFactory
        - Destination
        - Connection
        - Session
        - MessageProducer
        - MessageConsumer
        - Message
        - MessageListener
        - JMS 2.0
            - JMSContext
            - JMSProducer
            - JMSConsumer
- 常见中间件
    - RabbitMQ
        - 虚拟主机
        - 消息持久化
            - Queue : durable=true
            - Message : MessageProperties=BasicProperties.PERSISTENT_TEXT_PLAIN
            - Exchange : durable=true
        - 消息确认模式
            - AMQP协议事务机制
            - 信道设置成确认模式 : 普通确认、批量确认、异步确认
        - 消费者回执
            - 自动回执
            - 手动回执
            - 拒绝消息
            - 消息预取
        - 多通道 : 单线程
    - ActiveMQ
        - 连接器
            - VM
            - TCP
            - UDP
            - Multicast
            - NIO
            - SSL
            - HTTP/HTTPS
            - WebSocket
            - AMQP
            - MQTT、STOMP
            - Failover
            - Fanout
        - 持久话
            - AMQ
            - KahaDB
            - JDBC
            - 内存出处
            - LevelDB
        - 消息转发
            - PERSISTENT
            - NON_PERSISTENT
        - 消息积压
            - 消息过期
            - 死信队列(Dead Letter Queue)
        - 消息事物(Transaction)
            - JMS Transaction
            - XA Transaction
        - 消息应答
            - AUTO_ACKNOWLEDGE
            - CLIENT_ACKNOWLEDGE
            - DUPS_OK_ACKNOWLEDGE
            - INDIVIDUAL_ACKNOWLEDGE
        - 发送优化
            - 异步发送
            - 生产者流量控制(Producer Flow Control)
        - 消息消费优化
            - 消息预取
            - 慢速消费者
                - 等待消息限制(Pending Message Limit Strategy)
                    - constantPendingMessageLimitStrategy
                    - prefetchRatePedingMessageLimitStrategy
                - 丢弃策略
                    - oldestMessageEvictionStrategy
                    - oldestMessageWithLowestPriorityEvictionStrategy
                    - uniquePropertyMessageEvictionStrategy
    - Kafka
        - 分区(Partition)
        - 复制
        - 消息发送
            - 立即发送
            - 同步发送
            - 异步发送
        - 消息发送确认
            - 不等Broker确认
            - 由Leader确认
            - 有所有Leader和follower确认
        - 消息重发
        - 批次发送
        - 消费组
            - 广播和单播
            - 再均衡
        - 消费量偏移
            - 自动提交
            - 手动提交
            - 异步提交
    - RocketMQ提交
        - 消息重试
            - 生产者重试
            - 消费段重试
        - 消息重复(等幂性)